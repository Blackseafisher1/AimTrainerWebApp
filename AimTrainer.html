<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aim Trainer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
      color: white;
      overflow: hidden;
      user-select: none;
    }
    
    h1 {
      font-size: 2.8rem;
      margin: 15px 0;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
      background: linear-gradient(to right, #ff6b6b, #ffd166);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 1px;
    }
    
    #game-area {
      position: relative;
      width: 100%;
      height: 65vh;
      background: #111;
      margin: 10px auto;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
      border: 1px solid #333;
    }
    
    .target {
      position: absolute;
      background-color: red;
      border-radius: 50%;
      border: 20px solid rgb(189, 0, 0);
      cursor: pointer;
      box-shadow: 0px 0px 50px yellow;
      transition: background-color 0.2s ease, box-shadow 0.2s ease;
      z-index: 10;
    }
    
    .target:hover {
      box-shadow: 0px 0px 200px white;
      border: 20px solid rgb(82, 6, 6);
      background-color: rgb(131, 34, 34);
    }
    
    .target:active {
      background-color: rgb(66, 5, 5);
      border: 20px dashed rgb(53, 0, 0);
    }
    
    #controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    #controls > button, #sound-controls > button {
      background: linear-gradient(to bottom, #4a4a4a, #2d2d2d);
      color: white;
      border: none;
      padding: 12px 25px;
      margin: 0;
      cursor: pointer;
      border-radius: 30px;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
      transition: all 0.2s ease;
      min-width: 160px;
      letter-spacing: 0.5px;
      border: 1px solid #555;
    }
    
    #controls > button:hover, #sound-controls > button:hover {
      background: linear-gradient(to bottom, #5a5a5a, #3d3d3d);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
    }
    
    #controls > button:active, #sound-controls > button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
    }

    #info > button {
      background: linear-gradient(to bottom, #4a4a4a, #2d2d2d);
      color: white;
      border: none;
      padding: 12px 25px;
      margin: 0;
      cursor: pointer;
      border-radius: 30px;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
      transition: all 0.2s ease;
      min-width: 160px;
      letter-spacing: 0.5px;
      border: 1px solid #555;
    }
    
    #info > button:hover {
      background: linear-gradient(to bottom, #5a5a5a, #3d3d3d);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
    }
    
    #info > button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
    }
    
    #info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      max-width: 900px;
      margin: 20px auto;
      background: rgba(30, 30, 30, 0.8);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      border: 1px solid #444;
    }
    
    .info-item {
      background: rgba(20, 20, 20, 0.9);
      padding: 15px;
      border-radius: 8px;
      font-size: 1.1rem;
      border: 1px solid #444;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
    }
    
    .info-item span {
      display: block;
      font-size: 2.2rem;
      font-weight: bold;
      color: #ffd166;
      margin-top: 8px;
      text-shadow: 0 0 8px rgba(255, 209, 102, 0.5);
    }
    
    #best-score span {
      color: #06d6a0;
      text-shadow: 0 0 8px rgba(6, 214, 160, 0.5);
    }
    
    #time span {
      color: #ff6b6b;
      text-shadow: 0 0 8px rgba(255, 107, 107, 0.5);
    }
    
    .pulse {
      animation: pulse 0.5s ease;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .hit-effect {
      position: absolute;
      border-radius: 50%;
      pointer-events: none;
      z-index: 5;
      animation: hitEffect 0.6s forwards;
    }
    
    @keyframes hitEffect {
      0% { 
        transform: scale(0.5);
        opacity: 1;
        border: 15px solid rgba(255, 255, 255, 0.8);
      }
      100% { 
        transform: scale(2);
        opacity: 0;
        border: 5px solid rgba(255, 255, 255, 0);
      }
    }
    
    /* Sound controls styling */
    #sound-controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 15px auto;
      flex-wrap: wrap;
      max-width: 800px;
    }
    
    #sound-controls > div {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(30, 30, 30, 0.8);
      padding: 15px;
      border-radius: 10px;
      min-width: 300px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      border: 1px solid #444;
    }
    
    #sound-controls h3 {
      margin: 0 0 15px 0;
      color: #ffd166;
      text-shadow: 0 0 5px rgba(255, 209, 102, 0.5);
    }
    
    #sound-upload-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }
    
    #custom-sound-label {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 10px 20px;
      background: linear-gradient(to bottom, #4a4a4a, #2d2d2d);
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 80%;
      margin-bottom: 15px;
    }
    
    #custom-sound-label:hover {
      background: linear-gradient(to bottom, #5a5a5a, #3d3d3d);
      transform: translateY(-2px);
    }
    
    #sound-file {
      display: none;
    }
    
    #sound-preview {
      margin-top: 10px;
      font-size: 0.9rem;
      color: #aaa;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    #sound-volume {
      width: 80%;
      margin: 10px 0;
      -webkit-appearance: none;
      height: 8px;
      border-radius: 4px;
      background: #444;
      outline: none;
    }
    
    #sound-volume::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #ffd166;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(255, 209, 102, 0.8);
    }
    
    #volume-value {
      color: #ffd166;
      font-weight: bold;
      margin-top: 5px;
    }
    
    #sound-status {
      margin-top: 10px;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 0.9rem;
    }
    
    #sound-status.active {
      background: rgba(6, 214, 160, 0.2);
      color: #06d6a0;
    }
    
    #sound-status.inactive {
      background: rgba(255, 107, 107, 0.2);
      color: #ff6b6b;
    }
    
    @media (max-width: 600px) {
      #controls {
        flex-direction: column;
        align-items: center;
      }
      
      #sound-controls > div {
        min-width: 90%;
      }
      
      button {
        width: 90%;
        max-width: 300px;
      }
      
      h1 {
        font-size: 2.2rem;
      }
      
      .info-item span {
        font-size: 1.8rem;
      }
      
      #game-area {
        height: 60vh;
      }
    }
  </style>
</head>
<body>

<h1>Aim Trainer</h1>

<div id="game-area"></div>

<div id="controls">
  <button id="size-btn">Change Target Size</button>
  <button id="mode-btn">Switch Mode</button>
  <button id="stop-btn">Stop Round</button>
</div>

<div id="sound-controls">
  <div>
    <h3>Sound Settings</h3>
    <div id="sound-upload-container">
      <label id="custom-sound-label" for="sound-file">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M16 13H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M16 17H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M10 9H9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Upload Custom Sound
      </label>
      <input type="file" id="sound-file" accept="audio/*">
      <div id="sound-preview">No sound selected</div>
      
      <button id="reset-sound">Reset to Default Sound</button>
    </div>
  </div>
  
  <div>
    <h3>Volume Control</h3>
    <input type="range" id="sound-volume" min="0" max="1" step="0.1" value="0.5">
    <div id="volume-value">50%</div>
    <div id="sound-status" class="active">Sound: ON</div>
  </div>
</div>

<div id="info">
  <div class="info-item" id="time-item">
    Time Left: <span id="time">60</span>
  </div>
  <div class="info-item">
    Score: <span id="score">0</span>
  </div>
  <div class="info-item">
    Missclicks: <span id="missclicks">0</span>
  </div>
  <div class="info-item" id="best-score">
    Best Score: <span id="best-score">0</span>
  </div>
  <div class="info-item">
    Mode: <span id="mode-display">Single</span>
  </div>
</div>

<script>
  const gameArea = document.getElementById('game-area');
  const timeDisplay = document.getElementById('time');
  const scoreDisplay = document.getElementById('score');
  const missclicksDisplay = document.getElementById('missclicks');
  const bestScoreDisplay = document.getElementById('best-score');
  const sizeBtn = document.getElementById('size-btn');
  const stopBtn = document.getElementById('stop-btn');
  const modeBtn = document.getElementById('mode-btn');
  const modeDisplay = document.getElementById('mode-display');
  const timeItem = document.getElementById('time-item');
  const soundFileInput = document.getElementById('sound-file');
  const resetSoundBtn = document.getElementById('reset-sound');
  const soundPreview = document.getElementById('sound-preview');
  const soundVolume = document.getElementById('sound-volume');
  const volumeValue = document.getElementById('volume-value');
  const soundStatus = document.getElementById('sound-status');

  // Audio variables
  let customSound = null;
  let defaultSoundEnabled = true;
  let volume = 0.5;

  // Load saved sound from localStorage if available
  if (localStorage.getItem('aimTrainerSound')) {
    try {
      const soundData = localStorage.getItem('aimTrainerSound');
      customSound = new Audio();
      customSound.src = soundData;
      soundPreview.textContent = "Custom sound loaded";
      soundPreview.style.color = "#06d6a0";
    } catch (e) {
      console.error("Error loading custom sound:", e);
      soundPreview.textContent = "Error loading custom sound";
      soundPreview.style.color = "#ff6b6b";
    }
  }

  // Load volume setting
  if (localStorage.getItem('aimTrainerVolume')) {
    volume = parseFloat(localStorage.getItem('aimTrainerVolume'));
    soundVolume.value = volume;
    volumeValue.textContent = Math.round(volume * 100) + '%';
  }

  // Volume control
  soundVolume.addEventListener('input', () => {
    volume = parseFloat(soundVolume.value);
    volumeValue.textContent = Math.round(volume * 100) + '%';
    localStorage.setItem('aimTrainerVolume', volume);
  });

  // Toggle sound status
  soundStatus.addEventListener('click', () => {
    defaultSoundEnabled = !defaultSoundEnabled;
    updateSoundStatus();
  });

  function updateSoundStatus() {
    if (defaultSoundEnabled) {
      soundStatus.textContent = "Sound: ON";
      soundStatus.className = "active";
    } else {
      soundStatus.textContent = "Sound: OFF";
      soundStatus.className = "inactive";
    }
  }

  // Handle sound file upload
  soundFileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;

    // Validate file type
    if (!file.type.startsWith('audio/')) {
      soundPreview.textContent = "Invalid file type. Please upload an audio file.";
      soundPreview.style.color = "#ff6b6b";
      return;
    }

    // Preview file name
    soundPreview.textContent = file.name;
    soundPreview.style.color = "#aaa";

    // Read file as data URL
    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        // Save to localStorage
        localStorage.setItem('aimTrainerSound', event.target.result);
        
        // Create audio object
        customSound = new Audio();
        customSound.src = event.target.result;
        
        soundPreview.textContent = "Sound loaded: " + file.name;
        soundPreview.style.color = "#06d6a0";
      } catch (error) {
        console.error("Error loading sound file:", error);
        soundPreview.textContent = "Error loading sound file";
        soundPreview.style.color = "#ff6b6b";
      }
    };
    reader.readAsDataURL(file);
  });

  // Reset sound to default
  resetSoundBtn.addEventListener('click', () => {
    localStorage.removeItem('aimTrainerSound');
    customSound = null;
    soundPreview.textContent = "Using default sound";
    soundPreview.style.color = "#ffd166";
  });

  // Sound effect function
  function playHitSound() {
    if (!defaultSoundEnabled) return;
    
    try {
      // Try to play custom sound if available
      if (customSound) {
        const soundClone = new Audio(customSound.src);
        soundClone.volume = volume;
        soundClone.play().catch(e => console.log("Custom sound play error:", e));
        return;
      }
      
      // Fallback to default sound
      const context = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = context.createOscillator();
      const gainNode = context.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(context.destination);
      
      oscillator.type = 'sine';
      oscillator.frequency.value = 880; // A5 note
      gainNode.gain.value = volume * 0.3;
      
      oscillator.start();
      
      // Create a quick fade out
      gainNode.gain.exponentialRampToValueAtTime(0.001, context.currentTime + 0.15);
      
      setTimeout(() => {
        oscillator.stop();
      }, 150);
    } catch (e) {
      console.log("Audio not supported in this environment");
    }
  }
  
  // Create visual hit effect
  function createHitEffect(x, y, size) {
    const effect = document.createElement('div');
    effect.className = 'hit-effect';
    effect.style.left = `${x - size/2}px`;
    effect.style.top = `${y - size/2}px`;
    effect.style.width = `${size}px`;
    effect.style.height = `${size}px`;
    gameArea.appendChild(effect);
    
    setTimeout(() => {
      gameArea.removeChild(effect);
    }, 600);
  }

  const roundTime = 60;
  let timeLeft = roundTime;
  let score = 0;
  let missClicks = 0;
  let bestScore = 0;
  let intervalId = null;
  let roundStarted = false;
  const sizes = [50, 70, 100, 150];
  let currentSizeIndex = 3;

  let mode = 'single'; // 'single' or 'multi'
  let targets = [];
  let lastPositions = [];

  const settings = {
    single: { count: 1, radius: 400},
    multi: { count: 3, radius: 300 }
  };

  if (localStorage.getItem('bestAimScore')) {
    bestScore = parseInt(localStorage.getItem('bestAimScore'));
    bestScoreDisplay.textContent = bestScore;
  }

  function updateDisplays() {
    scoreDisplay.textContent = score;
    missclicksDisplay.textContent = missClicks;
    timeDisplay.textContent = timeLeft;
    modeDisplay.textContent = mode === 'single' ? 'Single' : 'Multi';
    
    // Add pulse animation to score when it changes
    scoreDisplay.parentElement.classList.remove('pulse');
    void scoreDisplay.parentElement.offsetWidth; // Trigger reflow
    scoreDisplay.parentElement.classList.add('pulse');
    
    // Flash time when below 10 seconds
    if (timeLeft < 11) {
      timeItem.style.animation = 'pulse 0.8s infinite';
      timeItem.style.background = 'rgba(255, 50, 50, 0.3)';
    } else {
      timeItem.style.animation = '';
      timeItem.style.background = '';
    }
  }

  function getNonOverlappingPosition(size, existing, radius) {
    const areaRect = gameArea.getBoundingClientRect();
    const centerX = areaRect.width / 2;
    const centerY = areaRect.height / 2;
    const maxLeft = areaRect.width - size;
    const maxTop = areaRect.height - size;

    let tries = 100;
    while (tries-- > 0) {
      const angle = Math.random() * 2 * Math.PI;
      const distance = Math.random() * radius;
      let left = centerX + Math.cos(angle) * distance - size / 2;
      let top = centerY + Math.sin(angle) * distance - size / 2;

      left = Math.min(Math.max(0, left), maxLeft);
      top = Math.min(Math.max(0, top), maxTop);

      let overlapping = existing.some(pos => {
        let dx = pos.left - left;
        let dy = pos.top - top;
        return Math.sqrt(dx * dx + dy * dy) < size;
      });

      if (!overlapping) return { left, top };
    }

    // fallback
    return { left: Math.random() * maxLeft, top: Math.random() * maxTop };
  }

  function moveTargetToNewPosition(targetIndex) {
    const size = sizes[currentSizeIndex];
    const radius = settings[mode].radius;
    const areaRect = gameArea.getBoundingClientRect();
    const centerX = areaRect.width / 2;
    const centerY = areaRect.height / 2;
    const existing = lastPositions.filter((_, i) => i !== targetIndex);
    const pos = getNonOverlappingPosition(size, existing, radius);
    lastPositions[targetIndex] = pos;
    targets[targetIndex].style.left = pos.left + 'px';
    targets[targetIndex].style.top = pos.top + 'px';
  }

  function teleportAllTargets() {
    const size = sizes[currentSizeIndex];
    const radius = settings[mode].radius;
    lastPositions = [];

    targets.forEach((target, i) => {
      const pos = getNonOverlappingPosition(size, lastPositions, radius);
      lastPositions.push(pos);
      target.style.left = pos.left + 'px';
      target.style.top = pos.top + 'px';
    });
  }

  function createTargets() {
    targets.forEach(t => t.remove());
    targets = [];

    const count = settings[mode].count;
    const size = sizes[currentSizeIndex];

    for (let i = 0; i < count; i++) {
      const btn = document.createElement('button');
      btn.className = 'target';
      btn.style.width = size + 'px';
      btn.style.height = size + 'px';

      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        
        // Play sound effect
        playHitSound();
        
        // Create visual effect
        const rect = btn.getBoundingClientRect();
        const areaRect = gameArea.getBoundingClientRect();
        createHitEffect(
          rect.left - areaRect.left + size/2, 
          rect.top - areaRect.top + size/2,
          size
        );
        
        if (!roundStarted) {
          startRound();
        } else {
          score++;
          updateDisplays();

          if (mode === 'multi') {
            moveTargetToNewPosition(i); // Nur dieses Ziel bewegen
          } else {
            teleportAllTargets(); // Einzelmodus: alles neu platzieren
          }
        }
      });

      gameArea.appendChild(btn);
      targets.push(btn);
    }

    teleportAllTargets();
  }

  function startRound() {
    if (roundStarted) return;
    roundStarted = true;

    timeLeft = roundTime;
    score = 0;
    missClicks = 0;
    updateDisplays();

    intervalId = setInterval(() => {
      timeLeft--;
      updateDisplays();

      if (timeLeft <= 0) {
        endRound();
      }
    }, 1000);
  }

  function endRound() {
    clearInterval(intervalId);
    intervalId = null;
    roundStarted = false;

    let finalScore = score - missClicks;
    if (finalScore < 0) finalScore = 0;

    alert(`Round over! Your score: ${score} - Missclicks: ${missClicks} = Final score: ${finalScore}`);

    if (finalScore > bestScore) {
      bestScore = finalScore;
      bestScoreDisplay.textContent = bestScore;
      localStorage.setItem('bestAimScore', bestScore);
      alert('New Best Score!');
    }
  }

  gameArea.addEventListener('click', () => {
    if (roundStarted) {
      missClicks++;
      updateDisplays();
    }
  });

  sizeBtn.addEventListener('click', () => {
    currentSizeIndex = (currentSizeIndex + 1) % sizes.length;
    targets.forEach(target => {
      target.style.width = sizes[currentSizeIndex] + 'px';
      target.style.height = sizes[currentSizeIndex] + 'px';
    });
    teleportAllTargets();
  });

  modeBtn.addEventListener('click', () => {
    mode = mode === 'single' ? 'multi' : 'single';
    createTargets();
    updateDisplays();
  });

  stopBtn.addEventListener('click', () => {
    if (roundStarted) {
      endRound();
    }
  });

  // Init
  createTargets();
  updateDisplays();
  updateSoundStatus();
  window.addEventListener('resize', teleportAllTargets);
</script>

</body>
</html>